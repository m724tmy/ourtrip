<div class="container mt-5">
  <!-- ルーム情報 -->
  <div class="mb-4 text-center">
    <h1 class="mb-3"><%= @room.room_name %></h1>
    <p class="text-muted"><%= @room.description %></p>
<% if @room.start_time.present? && @room.end_time.present? %>
  <p><strong>開始日時:</strong> <%= @room.start_time.strftime("%Y-%m-%d %H:%M") %></p>
  <p><strong>終了日時:</strong> <%= @room.end_time.strftime("%Y-%m-%d %H:%M") %></p>
<% else %>
  <p><strong>開始日時:</strong>
  <p><strong>終了日時:</strong>
<% end %>

    <div class="d-flex justify-content-center gap-3">
      <%= link_to "Edit", edit_room_path(@room), class: "btn btn-primary" %>
      <%= button_to '退出', leave_room_path(@room), method: :delete, data: { confirm: "本当に退出しますか？" }, class: "btn btn-danger" %>
      <%= link_to "もどる", root_path, class: "btn btn-secondary" %>
    </div>
  </div>

  <!-- コンテンツ: スケジュールと行きたい場所 -->
  <div class="row">
    <!-- 左: スケジュール -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <h2 class="h5 mb-0">スケジュール一覧</h2>
          <%= link_to "スケジュールを追加", new_room_schedule_path(@room), class: "btn btn-light btn-sm" %>
        </div>
        <div class="card-body">
          <% if @room.schedules.any? %>
            <ul class="list-group">
              <% @room.schedules.each do |schedule| %>
                <li class="list-group-item">
                  <strong><%= schedule.title %></strong><br>
                  <span class="text-muted">
                    <%= schedule.start_time.strftime("%Y-%m-%d %H:%M") %> 〜 <%= schedule.end_time.strftime("%Y-%m-%d %H:%M") %>
                  </span>
                  <p class="mt-2"><%= schedule.description %></p>
                  <p><strong>コスト:</strong> <%= schedule.cost %>円</p>
                  <%= link_to '詳細を表示', room_schedule_path(schedule.room, schedule), class: 'btn btn-info btn-sm' %>
                </li>
              <% end %>
            </ul>
          <% else %>
            <p class="text-muted">スケジュールがまだありません。</p>
          <% end %>
        </div>
      </div>
    </div>

    <!-- 右: 行きたい場所 -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
          <h2 class="h5 mb-0">行きたい場所一覧</h2>
          <%= link_to "行きたい場所を追加", new_room_location_path(@room), class: "btn btn-light btn-sm" %>
        </div>
        <div class="card-body">
          <% if @room.locations.any? %>
            <ul class="list-group">
              <% @room.locations.each do |location| %>
                <li class="list-group-item">
                  <strong><%= location.title %></strong><br>
                  <%= button_to 'スケジュールに追加', add_from_location_room_schedules_path(@room, location_id: location.id), method: :post %>

                  <span class="text-muted">
                    <%= location.start_time.strftime("%Y-%m-%d %H:%M") %> 〜 <%= location.end_time.strftime("%Y-%m-%d %H:%M") %>
                  </span>
                  <p class="mt-2"><%= location.description %></p>
                  <p><strong>コスト:</strong> <%= location.cost %>円</p>
                  <%= link_to '詳細を表示', room_location_path(location.room, location), class: 'btn btn-info btn-sm' %>
                </li>
              <% end %>
            </ul>
          <% else %>
            <p class="text-muted">行きたい場所がまだありません。</p>
          <% end %>
        </div>
      </div>
    </div>

    
<div class="mt-5">
  <div class="card">
    <div class="card-header bg-info text-white">
      <h2 class="h5 mb-0">ChatBOT</h2>
    </div>
    <div class="card-body">
      <!-- チャット履歴 -->
      <div id="chat-history" class="mb-3" style="max-height: 300px; overflow-y: auto;">
        <% if @chat_history.present? %>
          <% @chat_history.each do |message| %>
            <div class="mb-2">
              <strong><%= message.role == 'user' ? 'You:' : 'GPT:' %></strong>
              <p><%= message.content %></p>
            </div>
          <% end %>
        <% else %>
          <p class="text-muted">まだメッセージがありません。</p>
        <% end %>
      </div>

      <%== form_with url: chatgpt_room_path(@room), method: :post, local: false, id: "chat-form" do |f| %>
        <div class="input-group">
          <%= f.text_field :message, class: "form-control", placeholder: "メッセージを入力してください", value: "" %>
          <button class="btn btn-primary" type="submit">送信</button>
        </div>
      <% end %>
    </div>
  </div>
</div>

  </div>
</div>
